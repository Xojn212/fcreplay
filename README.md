# About
This project will automatically encoded [fightcade](https://www.fightcade.com/) replays and upload them to archive.org: [Gino Lisignoli - Archive.org](https://archive.org/search.php?query=creator%3A%22Gino+Lisignoli%22) or youtube: [fightcade archive](https://www.youtube.com/channel/UCrYudzO9Nceu6mVBnFN6haA)

A web site the view the archive.org replays is here: https://fightcadevids.com

fcreplay is primarly a python application used to automate the generation of fightcade replays as video files.

# Goal
The goal of this is to make fightcade replays accessible to anyone to watch without using an emulator.

# Features
fcreplay has several features to automate the encoding process and add aditional data to the generated videos

## Description generation
A desctiption is generated that contains:
1. The fightcade replay id
2. The fightcade player ids
3. The fightcade player locations
4. The game being played
5. The date the game was played
6. (Optional) A appended description

# Requirements
## Database
Fcreplay uses sqlalchemy and has been tested with postgres and is used store any replay metadata
Docker and docker-compose is required to run the application

### A few more notes:
To trigger recording, the file `started.inf` is checked. If the file exists then pyautogui is used to start recording the avi file(s)

The i3 window manager is used to ensure that the fcadefbneo window is always in the same place.

This is all done in a headless X11 session

## Todo
 - Better exception handling.
 - Thumbnails are generated but not used by archive.org

## Hardware
To run this, you need:
 1. A VM or physical machine.
     1. With at least 4 Cores (Fast ones would be ideal)
     1. With at least 4GB Ram
     1. With at least 250GB of storage 
        1. This is the amount of temporary storage required to encode a replay of up to 3 hours long. Replay recording requires ~20MB/sec
 2. Running docker and docker-compose
 3. Some familiarity with linux will help

### Uploading to youtube.com
To upload files to youtube.com you need to setup a youtube api endpoint. See here: https://github.com/tokland/youtube-upload

#### Bad words file
To prevent youtube from giving your channel strikes, you should create a 'bad_words.txt' file containing words you wish to block. These will be looked for in the description (so player names, etc). This file needs to be added as a volume to the tasker instance, and as an environment variable to the tasker instance.

### Uploading to archive.org
To upload files to archive.org, set the configuration key `upload_to_ia` to `true` and configure the ia section in the configuration file. You will also need to have your `.ia` secrets file in your users home directory. This can be generated by running `ia configure` from the command line once you have setup the python virtual environment.

# Installation and setup
## Configuration
The defaults should work if you follow the guide below.

You will also want to have the following files:
 - Configuration file: `config.json`
 - Appened description: `description_append.txt`
 - Google api client secrets: `.client_secrets.json`
 - Youtube upload credentials: `.youtube-upload-credentials.json`
 - Archive.org secrets: `.ia`

## Building
First generate a docker-compose.override.yml file from the example

Useing docker-compose, run the following to build the base image
```commandline
docker-compose build
```

# Usage
The typical useage of fcreplay is to run `docker-compose up` to start the task scheduler that will launch the replay encoding containers

## Validating your config
This command will do a basic check on your config:
```commandline
docker-compose run --rm -v /path/to/config.json:/root/config.json:ro fcreplay-tasker fcreplay config validate /root/config.json
```

## Getting replays
This will download a replay, and place it in the database
```commandline
docker-compose run --rm -v /path/to/config.json:/root/config.json:ro fcreplay-tasker fcreplayget --help
```
